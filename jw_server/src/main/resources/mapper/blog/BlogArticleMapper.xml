<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jw_server.dao.blog.mapper.BlogArticleMapper">

    <select id="getFrontArticlePage" resultType="com.jw_server.dao.blog.vo.BlogFrontArticlePageVO">
        SELECT
            ba.article_id, ba.user_id, su.nickname, bc.category_name,
            ba.is_top, ba.article_cover, ba.article_title, ba.article_summary,
            ba.view_counts, ba.comment_counts,ba.create_time
        FROM
            `blog_article` AS ba
                LEFT JOIN sys_user AS su ON ba.user_id = su.id
                LEFT JOIN blog_category AS bc ON ba.category_id = bc.category_id
        WHERE
            ba.article_check='1' AND ba.is_deleted='0'
        ORDER BY is_top DESC, ba.create_time DESC
    </select>

    <update id="updateArticleViewCounts" parameterType="java.lang.Integer">
        UPDATE blog_article AS ba
        SET ba.view_counts = ba.view_counts+1
        WHERE ba.article_id= #{articleId};
    </update>

    <select id="getBlogFrontArticleDetails" parameterType="java.lang.Integer" resultType="com.jw_server.dao.blog.vo.BlogFrontArticleDetailsVO">
        SELECT
            ba.article_id, ba.user_id, su.nickname, bc.category_name,
            ba.is_top, ba.article_cover, ba.article_title, ba.article_summary,
            ba.article_content, ba.article_visible, ba.view_counts, ba.comment_allowed,
            ba.comment_counts, ba.article_check, ba.create_time, ba.update_time
        FROM
            `blog_article` AS ba
                LEFT JOIN sys_user AS su ON ba.user_id = su.id
                LEFT JOIN blog_category AS bc ON ba.category_id = bc.category_id
        WHERE
            ba.article_check='1' AND ba.is_deleted='0' AND ba.article_id = #{articleId};
    </select>
</mapper>
